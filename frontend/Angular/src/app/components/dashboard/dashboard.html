<div class="app-container">
  <app-navbar></app-navbar>
  <div class="main-content">
    <!-- Header -->
    <div class="header">
      <div class="header-left"><h1 class="page-title">Focusly</h1></div>
      <div class="header-right">
        <button class="header-btn calendar-toggle" (click)="toggleCalendar()">ğŸ“…</button>
        <button
          class="header-btn"
          routerLink="/settings"
          [routerLink]="['/settings']"
          routerLinkActive="active"
        >
          ğŸ‘¤
        </button>
        <div class="user-menu">
          <span>{{ currentUser }}</span> <span class="dropdown">â–¼</span>
        </div>
      </div>
    </div>
    <!-- Progress -->
    <div class="progress-section">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progressPercentage"></div>
      </div>
      <span class="progress-text">{{ progressPercentage }}% complete</span>
    </div>
    <!-- Tabs -->
    <div class="tabs"><button class="tab active">Main</button></div>
    <!-- Upcoming Work -->
    <div class="upcoming-section">
      <h2>Upcoming Work</h2>
      <div class="tasks-grid" *ngIf="tasks.length > 0">
        <div class="task-card" *ngFor="let task of tasks">
          <div class="task-header">
            <span class="task-time">â± {{ calculateTimeLeft(task.due_date) }}</span>
            <button class="menu-btn">...</button>
          </div>
          <h3>{{ task.title }}</h3>
          <p class="task-desc">{{ task.task_description }}</p>
          <div class="task-priority">
            <span [class]="'priority priority-' + task.priority?.toLowerCase()">
              {{ task.priority }}
            </span>
          </div>
          <div class="task-footer">
            <div class="task-dates">
              <span class="task-date">ğŸ“… {{ formatDate(task.due_date) }}</span>
            </div>
            <button class="done-btn" (click)="markTaskDone(task.task_id)">âœ“ Done</button>
          </div>
        </div>
      </div>
      <div class="no-tasks" *ngIf="tasks.length === 0"><p>No upcoming tasks</p></div>
    </div>
    <!-- Done Tasks Section -->
    <div class="done-section">
      <h4>Done Tasks</h4>
      <div class="tasks-grid" *ngIf="doneTasks.length > 0">
        <div class="task-card done-card" *ngFor="let task of doneTasks">
          <div class="task-header">
            <span class="task-time completed-badge">âœ“ Completed</span>
            <button class="menu-btn">...</button>
          </div>
          <h3>{{ task.title }}</h3>
          <p class="task-desc">{{ task.task_description }}</p>
          <div class="task-priority">
            <span [class]="'priority priority-' + task.priority?.toLowerCase()">
              {{ task.priority }}
            </span>
          </div>
          <div class="task-footer">
            <div class="task-dates">
              <span class="task-date">ğŸ“… {{ formatDate(task.due_date) }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="no-tasks" *ngIf="doneTasks.length === 0"><p>No completed tasks yet</p></div>
    </div>
    <!-- Performance Section -->
    <div class="performance-section">
      <div class="performance-header">
        <h2>Performance</h2>
        <span class="period">Last Week</span>
      </div>
      <div class="performance-grid">
        <!-- Chart 1 - Productivity -->
        <div class="chart-card">
          <div class="chart-title">Weekly Tasks Completed</div>
          <div class="chart-container"><canvas #productivityChart></canvas></div>
        </div>
        <!-- Chart 2 - Task Completion Rate -->
        <div class="chart-card">
          <div class="chart-title">Task Completion Rate</div>
          <div class="chart-container"><canvas #completionChart></canvas></div>
        </div>
        <!-- Chart 3 - Weekly Activity -->
        <div class="chart-card full-width">
          <div class="chart-title">Weekly Activity</div>
          <div class="activity-stats">
            <div class="stat-item">
              <div class="stat-icon">ğŸ“ Total Tasks:</div>
              <div class="stat-content">
                <div class="stat-number">{{ allTasks.length }}</div>
                <div class="stat-label"></div>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon">âœ… Completed:</div>
              <div class="stat-content">
                <div class="stat-number">{{ allDoneTasks.length }}</div>
                <div class="stat-label"></div>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon">â³ In Progress:</div>
              <div class="stat-content">
                <div class="stat-number">{{ inProgressTasksCount }}</div>
                <div class="stat-label"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Right Sidebar -->
  <div class="right-sidebar" [class.open]="isCalendarOpen">
    <button class="sidebar-close" (click)="toggleCalendar()">âœ•</button>
    <div class="calendar-section">
      <div class="calendar-header">
        <span class="month">Monthly</span> <span class="period-toggle">Daily</span>
      </div>
      <div class="calendar">
        <h3>{{ currentMonth }} {{ currentYear }}</h3>
        <div class="calendar-grid">
          <div class="calendar-day-header" *ngFor="let day of dayHeaders">{{ day }}</div>
          <div
            class="calendar-day"
            *ngFor="let date of calendarDates"
            [class.today]="date.isToday"
            [class.other-month]="!date.isCurrentMonth"
          >
            {{ date.day }}
            <span class="deadline-dot" *ngIf="date.hasDeadline && date.isCurrentMonth"></span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>